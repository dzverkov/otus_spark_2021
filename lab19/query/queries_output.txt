presto:default> select date_month,
             ->        trips_amount,
             ->        trips_amount - COALESCE(LAG(trips_amount) OVER (ORDER BY date_month), trips_amount) trips_changes
             -> from (
             ->     select date_format(CAST(trip_start_timestamp as timestamp), '%Y-%m') date_month,
             ->            count(*) trips_amount
             ->     from chicago_taxi_trips_parquet
             ->     group by 1
             -> );
 date_month | trips_amount | trips_changes
------------+--------------+---------------
 2013-01    |         7969 |             0
 2013-02    |         4672 |         -3297
 2013-03    |         4073 |          -599
 2013-04    |         6270 |          2197
 2013-05    |         1533 |         -4737
 2013-06    |        12199 |         10666
 2013-07    |         8802 |         -3397
 2013-08    |         5060 |         -3742
 2013-09    |         3167 |         -1893
 2013-10    |       811778 |        808611
 2013-11    |       347609 |       -464169
 2013-12    |       975977 |        628368
 2014-01    |       903481 |        -72496
 2014-02    |       140129 |       -763352
 2014-03    |       142400 |          2271
 2014-04    |       384029 |        241629
 2014-05    |       423353 |         39324
 2014-06    |       253442 |       -169911
 2014-07    |       610149 |        356707
 2014-08    |       476793 |       -133356
 2014-09    |       473037 |         -3756
 2014-10    |       660465 |        187428
 2014-11    |       388494 |       -271971
 2014-12    |       359956 |        -28538
 2015-01    |       361306 |          1350
 2015-02    |       349183 |        -12123
 2015-03    |       160734 |       -188449
 2015-04    |       481019 |        320285
 2015-05    |       418115 |        -62904
 2015-06    |       115452 |       -302663
 2015-07    |        96704 |        -18748
 2015-08    |       119033 |         22329
 2015-09    |       113204 |         -5829
 2015-10    |       117006 |          3802
 2015-11    |       101820 |        -15186
 2015-12    |       103761 |          1941
 2016-01    |       367435 |        263674
 2016-02    |       708647 |        341212
 2016-03    |       279844 |       -428803
 2016-04    |        13059 |       -266785
 2016-05    |        26182 |         13123
 2016-06    |       339325 |        313143
 2016-07    |       595697 |        256372
 2016-08    |       351536 |       -244161
 2016-09    |       291834 |        -59702
 2016-10    |           37 |       -291797
 2016-11    |         5326 |          5289
 2016-12    |         2158 |         -3168
 2017-01    |       510384 |        508226
 2017-02    |       140825 |       -369559
 2017-03    |        13779 |       -127046
 2017-04    |        40542 |         26763
 2017-05    |       338279 |        297737
 2017-06    |       540098 |        201819
 2017-07    |       208564 |       -331534
 2017-08    |       197971 |        -10593
 2017-09    |        13763 |       -184208
 2017-10    |        82654 |         68891
 2017-11    |       777320 |        694666
 2017-12    |       725706 |        -51614
 2018-01    |       441995 |       -283711
 2018-02    |       268159 |       -173836
 2018-03    |       145774 |       -122385
 2018-04    |       116389 |        -29385
 2018-05    |        72530 |        -43859
 2018-06    |      1077531 |       1005001
 2018-07    |       125310 |       -952221
 2018-08    |            2 |       -125308
 2018-09    |           16 |            14
 2018-10    |        52496 |         52480
 2018-11    |       174693 |        122197
 2018-12    |        51469 |       -123224
 2019-01    |        82082 |         30613
 2019-02    |        98930 |         16848
 2019-03    |        71300 |        -27630
 2019-04    |       632694 |        561394
 2019-05    |           26 |       -632668
 2019-06    |       645723 |        645697
 2019-07    |       611152 |        -34571
 2019-08    |          821 |       -610331
 2019-09    |         1120 |           299
 2019-10    |         1099 |           -21
 2020-01    |           13 |         -1086
 2020-02    |       367416 |        367403
 2020-03    |           17 |       -367399
 2020-04    |         1078 |          1061
 2020-05    |        13918 |         12840
 2020-09    |          973 |        -12945
 2020-10    |          620 |          -353
 2020-11    |            1 |          -619
 2020-12    |         1087 |          1086
 2021-01    |          535 |          -552
 2021-02    |            1 |          -534
(93 rows)

Query 20210523_193325_00006_3x9vz, FINISHED, 4 nodes
Splits: 226 total, 226 done (100.00%)
5:46 [21.6M rows, 71.6MB] [62.4K rows/s, 212KB/s]
---------------------------------------------------------------------------------------------------------------------------

presto:default> select company,
             ->     sum(trip_total) as trip_total
             -> from chicago_taxi_trips_parquet
             -> group by company
             -> order by 2 desc
             -> limit 10;
             company             | trip_total
---------------------------------+-------------
 Flash Cab                       |    7.4193E7
                                 | 5.0763256E7
 Taxi Affiliation Services       | 3.4136392E7
 Yellow Cab                      | 2.5403942E7
 Chicago Carriage Cab Corp       | 2.1187978E7
 Medallion Leasin                |  1.575995E7
 Sun Taxi                        | 1.5358416E7
 City Service                    | 1.5165768E7
 Taxi Affiliation Service Yellow | 1.2708311E7
 Dispatch Taxi Affiliation       |   7567762.5
(10 rows)

Query 20210523_194547_00011_3x9vz, FINISHED, 4 nodes
Splits: 210 total, 210 done (100.00%)
0:01 [21.6M rows, 38.6MB] [15.5M rows/s, 27.7MB/s]
---------------------------------------------------------------------------------------------------------------------------

presto:default> with tm as (
             -> select case when trip_miles < 5 then '1_trip_miles_lt4'
             ->             when trip_miles between 5 and 15 then '2_trip_miles5_15'
             ->             when trip_miles between 16 and 25 then '3_trip_miles16_25'
             ->             when trip_miles between 26 and 100 then '4_trip_miles26_100'
             ->             else 'other' end as trip_miles_category
             -> from chicago_taxi_trips_parquet
             -> )
             -> select trip_miles_category,
             -> count(*) cnt,
             -> count(*)/cast(sum(count(*)) over() as double) as part
             -> from tm
             -> group by trip_miles_category
             -> order by 1;
 trip_miles_category |   cnt    |         part
---------------------+----------+----------------------
 1_trip_miles_lt4    | 17459700 |   0.8094395814133345
 2_trip_miles5_15    |  2529118 |  0.11725105329787625
 3_trip_miles16_25   |  1307377 | 0.060610588476859344
 4_trip_miles26_100  |   101764 | 0.004717825023508226
 other               |   172150 | 0.007980951788421653
(5 rows)

Query 20210523_201952_00029_3x9vz, FINISHED, 4 nodes
Splits: 295 total, 295 done (100.00%)
0:02 [21.6M rows, 29.5MB] [11.4M rows/s, 15.6MB/s]